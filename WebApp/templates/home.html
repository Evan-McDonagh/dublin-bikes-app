<!-- this page will inherit code from layout which is common to age -->
{% extends "layout.html" %}

<!-- to inherit start a block -->
{% block content %}

<!-- to loop through posts list made on test.py -->
    {% for post in posts %}
        <!-- for variables use double curly braces -->
        <h1>{{ post.title }}</h1>
        <p>By {{ post.author }} on {{ post.date_posted }}</p>
        <p>{{ post.content}} </p>
        <script>console.log('{{ post }}');</script>
    {% endfor %}


    <div id="map"></div>
    <script>
        var map;
        var infowindow;
        function initMap() {
            


            function addMarker(lat, lon, name) {
                console.log(lat);
                var latLng = new google.maps.LatLng(lat, lon);
                var marker = new google.maps.Marker({
                    position: latLng,
                    map: map
                });
                var infowindow = new google.maps.InfoWindow({
                    content: name
                });

                marker.addListener('click', function() {
                    var tempMap = infowindow.getMap();
                    // if (tempMap !== null && typeof tempMap !== "undefined") {
                    //     infowindow.close();
                    // }
                    if (infowindow) {
                    infowindow.close();
                        }
                    infowindow.open(map, marker);
                });
            }
       
            var dublin = { lat: 53.3498, lng: -6.2603 };
            // The map, centered at Dublin
            map = new google.maps.Map(
            document.getElementById('map'), { zoom: 13, center: dublin });

            // The location data is sent from Flask to js
            // '|tojson' converts the locationdata variable to json, which is then parsed in js
            locData = JSON.parse('{{ locationdata|tojson }}')
            for (const loc of locData) {
                addMarker(loc["lat"], loc["lon"], loc["name"]);
            }
        }

    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBk5FkeAnIxVpfk2ufqO3F1ofYF84oDT6c&callback=initMap"></script>

<!-- end the block. The word content not required -->
{% endblock content %}